<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>表格</title>
    <style>
        table {
            display: table;
        }
        td {
            border: 1px solid #333;
        }
    </style>
</head>

<body>
    <div class="body" id="body">
        <input id="uploadBtn" type="file">
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.1/xlsx.full.min.js"></script>
    <script src="./asset/FileSaver.js"></script>
    <script>
        var rABS = false; // true: readAsBinaryString ; false: readAsArrayBuffer
        function handleFile(e) {
            var files = e.target.files,
                f = files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                if (!rABS) data = new Uint8Array(data);
                var workbook = XLSX.read(data, {
                    type: rABS ? 'binary' : 'array',
                    cellStyles: true
                });

                /* DO SOMETHING WITH workbook HERE */
                console.log('workbook', workbook);
                // addToHTML(workbook.Sheets.Sheet1);
                // changeDl(workbook.Sheets.Sheet1);
            };
            if (rABS) reader.readAsBinaryString(f);
            else reader.readAsArrayBuffer(f);
        }
        document.getElementById('uploadBtn').addEventListener('change', handleFile, false);

        function addToHTML(sheet) {
            let body = document.getElementById('body');
            let result = XLSX.utils.sheet_to_json(sheet);
            console.log('result', result);
            body.innerHTML +=
                `<pre>${XLSX.utils.sheet_to_html(sheet, {
                    editable: true
            })}</pre>`;

        }

        function changeDl(sheet) {
            sheet.C3.v = '老员工';
            sheet.C3.w = '老员工';
            let wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, '新的');
            /* output format determined by filename */
            XLSX.writeFile(wb, 'out.xlsb');
            /* at this point, out.xlsb will have been downloaded */
            // /* bookType can be any supported output type */
            // var wopts = { bookType:'xlsx', bookSST:false, type:'array' };

            // var wbout = XLSX.write(wb, wopts);

            // /* the saveAs call downloads a file on the local machine */
            // saveAs(new Blob([wbout], {type:"application/octet-stream"}), "fileceshi.xlsx");
        };
    </script>
</body>

</html>